<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configura√ß√µes Visual - Admin</title>
  <link rel="stylesheet" href="../assets/css/admin.css">
  <link rel="stylesheet" href="../assets/css/admin-mobile.css">
</head>
<body>
  <div class="admin-layout">
 <!-- Menu Hamb√∫rguer (Mobile) -->
    <button class="btn-menu-toggle-admin" id="menuToggleAdmin" aria-label="Abrir menu" aria-expanded="false">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>

    <!-- Overlay do Menu -->
    <div class="menu-overlay-admin" id="menuOverlayAdmin"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="adminSidebar">
      <div class="sidebar-header">
        <h2>üì¶ Admin</h2>
        <button class="btn-close-sidebar" id="btnCloseSidebar" aria-label="Fechar menu">
          <span>‚úï</span>
        </button>
      </div>
      <nav class="sidebar-nav">
        <a href="../index.html" class="nav-item">
          <span class="icon">üìä</span>
          <span>Dashboard</span>
        </a>
        <a href="../produtos.html" class="nav-item">
          <span class="icon">üì¶</span>
          <span>Produtos</span>
        </a>
        <a href="../metricas.html" class="nav-item">
          <span class="icon">üìà</span>
          <span>M√©tricas</span>
        </a>
        
        <!-- Submenu Configura√ß√µes -->
        <div class="nav-submenu">
          <span class="nav-submenu-title">‚öôÔ∏è Configura√ß√µes</span>
          <a href="visual.html" class="nav-item-sub active">
            <span class="icon">üé®</span>
            <span>Visual</span>
          </a>
          <a href="produtos.html" class="nav-item-sub">
            <span class="icon">üì¶</span>
            <span>Produtos</span>
          </a>
          <a href="banners.html" class="nav-item-sub">
            <span class="icon">üñºÔ∏è</span>
            <span>Banners</span>
          </a>
          <a href="pagamento.html" class="nav-item-sub">
            <span class="icon">üí≥</span>
            <span>Pagamento</span>
          </a>
          <a href="comunicacao.html" class="nav-item-sub">
            <span class="icon">üí¨</span>
            <span>Comunica√ß√£o</span>
          </a>
          <a href="tracking.html" class="nav-item-sub">
            <span class="icon">üìä</span>
            <span>Tracking</span>
          </a>
        </div>
        
        <a href="https://catalogo.drakfeet.com" class="nav-item" target="_blank">
          <span class="icon">üåê</span>
          <span>Ver Cat√°logo</span>
        </a>
      </nav>
      <div class="sidebar-footer">
        <button id="logoutBtn" class="btn-logout">Sair</button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="topbar">
        <h1>üé® Configura√ß√µes Visual</h1>
        <div class="topbar-actions">
          <button class="btn-theme-toggle-admin" id="themeToggleAdmin" aria-label="Alternar tema">
            <span class="theme-icon">üåô</span>
          </button>
        </div>
      </header>

      <div class="container">
        <form id="configVisualForm" class="form-card">
          
          <!-- Identidade da Loja -->
          <section class="config-section">
            <h2>üè™ Identidade da Loja</h2>
            
            <div class="form-group">
              <label for="nomeLoja">Nome da Loja *</label>
              <input type="text" id="nomeLoja" name="nomeLoja" required>
            </div>

            <div class="form-group">
              <label for="logoUpload">Logo da Loja</label>
              <input type="file" id="logoUpload" accept="image/*">
              <input type="hidden" id="logoUrl" name="logoUrl">
              <div id="logoPreview" class="image-preview"></div>
              <small>Recomendado: 200x60px (PNG com fundo transparente)</small>
            </div>
          </section>

          <!-- Cores do Cat√°logo - EXPANDIDO -->
          <section class="config-section">
            <h2>üé® Personaliza√ß√£o Completa de Cores</h2>
            
            <h3 style="font-size: 16px; margin-bottom: 20px; color: var(--text-secondary);">üîµ Cores Principais</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="corPrimaria">Cor Prim√°ria</label>
                <div class="color-picker-group">
                  <input type="color" id="corPrimaria" name="corPrimaria" value="#6366f1">
                  <input type="text" id="corPrimariaTexto" value="#6366f1" readonly>
                </div>
                <small>Bot√µes principais, links e destaques importantes</small>
              </div>

              <div class="form-group">
                <label for="corSecundaria">Cor Secund√°ria (WhatsApp)</label>
                <div class="color-picker-group">
                  <input type="color" id="corSecundaria" name="corSecundaria" value="#10b981">
                  <input type="text" id="corSecundariaTexto" value="#10b981" readonly>
                </div>
                <small>Bot√µes WhatsApp e destaques verdes</small>
              </div>
            </div>

            <h3 style="font-size: 16px; margin: 30px 0 20px; color: var(--text-secondary);">üåë Fundo e Texto</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="corFundo">Cor de Fundo Geral</label>
                <div class="color-picker-group">
                  <input type="color" id="corFundo" name="corFundo" value="#0f172a">
                  <input type="text" id="corFundoTexto" value="#0f172a" readonly>
                </div>
                <small>Cor de fundo principal do cat√°logo</small>
              </div>

              <div class="form-group">
                <label for="corTexto">Cor do Texto Principal</label>
                <div class="color-picker-group">
                  <input type="color" id="corTexto" name="corTexto" value="#f1f5f9">
                  <input type="text" id="corTextoTexto" value="#f1f5f9" readonly>
                </div>
                <small>Cor dos textos e t√≠tulos</small>
              </div>
            </div>

            <h3 style="font-size: 16px; margin: 30px 0 20px; color: var(--text-secondary);">üì± Header e Menu de Navega√ß√£o</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="corHeaderBg">Cor de Fundo do Header</label>
                <div class="color-picker-group">
                  <input type="color" id="corHeaderBg" name="corHeaderBg" value="#1e293b">
                  <input type="text" id="corHeaderBgTexto" value="#1e293b" readonly>
                </div>
                <small>Fundo do cabe√ßalho e barra de navega√ß√£o</small>
              </div>

              <div class="form-group">
                <label for="corMenuTexto">Cor do Texto do Menu</label>
                <div class="color-picker-group">
                  <input type="color" id="corMenuTexto" name="corMenuTexto" value="#94a3b8">
                  <input type="text" id="corMenuTextoTexto" value="#94a3b8" readonly>
                </div>
                <small>Cor dos itens do menu de categorias</small>
              </div>
            </div>

            <h3 style="font-size: 16px; margin: 30px 0 20px; color: var(--text-secondary);">üÉè Cards de Produtos</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="corCardBg">Cor de Fundo dos Cards</label>
                <div class="color-picker-group">
                  <input type="color" id="corCardBg" name="corCardBg" value="#1e293b">
                  <input type="text" id="corCardBgTexto" value="#1e293b" readonly>
                </div>
                <small>Fundo dos cards de produtos</small>
              </div>

              <div class="form-group">
                <label for="corCardBorda">Cor da Borda dos Cards</label>
                <div class="color-picker-group">
                  <input type="color" id="corCardBorda" name="corCardBorda" value="#334155">
                  <input type="text" id="corCardBordaTexto" value="#334155" readonly>
                </div>
                <small>Bordas dos cards de produtos</small>
              </div>
            </div>

            <h3 style="font-size: 16px; margin: 30px 0 20px; color: var(--text-secondary);">ü¶∂ Footer (Rodap√©)</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="corFooterBg">Cor de Fundo do Footer</label>
                <div class="color-picker-group">
                  <input type="color" id="corFooterBg" name="corFooterBg" value="#0f172a">
                  <input type="text" id="corFooterBgTexto" value="#0f172a" readonly>
                </div>
                <small>Fundo do rodap√©</small>
              </div>

              <div class="form-group">
                <label for="corFooterTexto">Cor do Texto do Footer</label>
                <div class="color-picker-group">
                  <input type="color" id="corFooterTexto" name="corFooterTexto" value="#94a3b8">
                  <input type="text" id="corFooterTextoTexto" value="#94a3b8" readonly>
                </div>
                <small>Cor dos textos no rodap√©</small>
              </div>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: rgba(99, 102, 241, 0.1); border-radius: 12px; border: 1px solid rgba(99, 102, 241, 0.3);">
              <button type="button" class="btn btn-secondary" style="width: 100%;" onclick="resetarCores()">
                üîÑ Restaurar Todas as Cores Padr√£o
              </button>
            </div>
          </section>

          <!-- Aviso Informativo -->
          <section class="config-section">
            <h2>üì¢ Aviso Informativo</h2>
            
            <div class="form-group">
              <label for="avisoTexto">Texto do Aviso Principal</label>
              <textarea id="avisoTexto" name="avisoTexto" rows="3"></textarea>
              <small>Aviso destacado no topo do cat√°logo</small>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="avisoBotaoTexto">Texto do Bot√£o</label>
                <input type="text" id="avisoBotaoTexto" name="avisoBotaoTexto">
              </div>
              <div class="form-group">
                <label for="avisoBotaoUrl">URL do Bot√£o</label>
                <input type="url" id="avisoBotaoUrl" name="avisoBotaoUrl">
              </div>
            </div>
          </section>

          <!-- Taxa de Entrega -->
          <section class="config-section">
            <h2>üèçÔ∏è Entrega</h2>
            
            <div class="form-group">
              <label for="taxaMotoboy">Taxa de Entrega (R$)</label>
              <input type="number" id="taxaMotoboy" name="taxaMotoboy" step="0.01" min="0">
              <small>Deixe 0 para n√£o exibir aviso de entrega</small>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="exibirTaxaEntrega" name="exibirTaxaEntrega">
                Exibir aviso de taxa de entrega no cat√°logo
              </label>
            </div>
          </section>

          <!-- Preview ao Vivo -->
          <section class="config-section">
            <h2>üëÅÔ∏è Pr√©-visualiza√ß√£o das Cores</h2>
            <div class="preview-container">
              <div class="preview-box" id="previewCatalogo">
                <div class="preview-header" id="previewHeader">
                  <div class="preview-logo" id="previewLogo">Sua Loja</div>
                  <button class="preview-btn" id="previewBtn">Categoria</button>
                </div>
                <div class="preview-card" id="previewCard">
                  <div class="preview-card-content">
                    <h3 id="previewTexto">Produto Exemplo</h3>
                    <p style="color: var(--text-secondary); font-size: 14px;">R$ 199,90</p>
                    <button class="preview-whatsapp" id="previewWhatsapp">
                      üì± WhatsApp
                    </button>
                  </div>
                </div>
                <div class="preview-footer" id="previewFooter" style="margin-top: 20px; padding: 15px; border-radius: 8px;">
                  <p id="previewFooterText" style="font-size: 13px; margin: 0;">¬© 2025 Sua Loja - Rodap√©</p>
                </div>
              </div>
              <small>As cores ser√£o aplicadas em tempo real no preview acima</small>
            </div>
          </section>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">üíæ Salvar Todas as Configura√ß√µes</button>
          </div>
        </form>
      </div>
    </main>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <!-- Theme Service -->
  <script>
    if (!window.ThemeService) {
      window.ThemeService = {
        currentTheme: 'dark',
        init() {
          const savedTheme = localStorage.getItem('theme');
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          this.currentTheme = savedTheme || (prefersDark ? 'dark' : 'light');
          this.applyTheme(this.currentTheme);
        },
        applyTheme(theme) {
          this.currentTheme = theme;
          document.documentElement.setAttribute('data-theme', theme);
          localStorage.setItem('theme', theme);
          this.updateToggleIcon();
        },
        toggle() {
          const newTheme = this.currentTheme === 'dark' ? 'light' : 'dark';
          this.applyTheme(newTheme);
          return newTheme;
        },
        updateToggleIcon() {
          const toggleBtn = document.getElementById('themeToggleAdmin');
          if (toggleBtn) {
            const icon = toggleBtn.querySelector('.theme-icon') || toggleBtn;
            icon.textContent = this.currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
          }
        }
      };
    }
  </script>
  
  <script src="../assets/js/config.js"></script>
  <script src="../assets/js/crypto.service.js"></script>
  <script src="../assets/js/firebase.js"></script>
  <script src="../assets/js/auth.core.js"></script>
  <script src="../assets/js/auth.guard.js"></script>
  <script src="../assets/js/session.manager.js"></script>
  <script src="../assets/js/config.service.js"></script>
  <script src="../assets/js/produtos.service.js"></script>

  <script>
    // Inicializar tema
    ThemeService.init();
    
    // Configurar toggle de tema
    const themeToggle = document.getElementById('themeToggleAdmin');
    if (themeToggle) {
      themeToggle.addEventListener('click', () => ThemeService.toggle());
    }

    // Configurar menu hamb√∫rguer
    const menuToggle = document.getElementById('menuToggleAdmin');
    const sidebar = document.getElementById('adminSidebar');
    const overlay = document.getElementById('menuOverlayAdmin');
    const closeBtn = document.getElementById('btnCloseSidebar');

    function toggleMenu() {
      const isOpen = sidebar.classList.contains('mobile-open');
      sidebar.classList.toggle('mobile-open');
      if (overlay) overlay.classList.toggle('active');
      document.body.style.overflow = isOpen ? '' : 'hidden';
      menuToggle.setAttribute('aria-expanded', !isOpen);
    }

    if (menuToggle) menuToggle.addEventListener('click', toggleMenu);
    if (closeBtn) closeBtn.addEventListener('click', toggleMenu);
    if (overlay) overlay.addEventListener('click', toggleMenu);

    // Sincronizar color pickers com inputs de texto
    function setupColorSync(colorId, textoId) {
      const colorInput = document.getElementById(colorId);
      const textoInput = document.getElementById(textoId);

      colorInput.addEventListener('input', (e) => {
        textoInput.value = e.target.value;
        atualizarPreview();
      });
    }

    setupColorSync('corPrimaria', 'corPrimariaTexto');
    setupColorSync('corSecundaria', 'corSecundariaTexto');
    setupColorSync('corFundo', 'corFundoTexto');
    setupColorSync('corTexto', 'corTextoTexto');
    setupColorSync('corHeaderBg', 'corHeaderBgTexto');
    setupColorSync('corMenuTexto', 'corMenuTextoTexto');
    setupColorSync('corCardBg', 'corCardBgTexto');
    setupColorSync('corCardBorda', 'corCardBordaTexto');
    setupColorSync('corFooterBg', 'corFooterBgTexto');
    setupColorSync('corFooterTexto', 'corFooterTextoTexto');

    // Atualizar preview em tempo real
    function atualizarPreview() {
      const preview = document.getElementById('previewCatalogo');
      const header = document.getElementById('previewHeader');
      const btn = document.getElementById('previewBtn');
      const card = document.getElementById('previewCard');
      const whatsapp = document.getElementById('previewWhatsapp');
      const texto = document.getElementById('previewTexto');
      const footer = document.getElementById('previewFooter');
      const footerText = document.getElementById('previewFooterText');

      const corPrimaria = document.getElementById('corPrimaria').value;
      const corSecundaria = document.getElementById('corSecundaria').value;
      const corFundo = document.getElementById('corFundo').value;
      const corTexto = document.getElementById('corTexto').value;
      const corHeaderBg = document.getElementById('corHeaderBg').value;
      const corMenuTexto = document.getElementById('corMenuTexto').value;
      const corCardBg = document.getElementById('corCardBg').value;
      const corCardBorda = document.getElementById('corCardBorda').value;
      const corFooterBg = document.getElementById('corFooterBg').value;
      const corFooterTexto = document.getElementById('corFooterTexto').value;

      preview.style.background = corFundo;
      header.style.background = corHeaderBg;
      header.style.borderBottom = `2px solid ${corPrimaria}`;
      btn.style.background = corPrimaria;
      btn.style.color = 'white';
      card.style.background = corCardBg;
      card.style.border = `1px solid ${corCardBorda}`;
      whatsapp.style.background = corSecundaria;
      texto.style.color = corTexto;
      footer.style.background = corFooterBg;
      footerText.style.color = corFooterTexto;
    }

    // Resetar cores padr√£o
    function resetarCores() {
      if (!confirm('Restaurar TODAS as cores padr√£o? Esta a√ß√£o n√£o pode ser desfeita.')) return;

      const padroes = {
        corPrimaria: '#6366f1',
        corSecundaria: '#10b981',
        corFundo: '#0f172a',
        corTexto: '#f1f5f9',
        corHeaderBg: '#1e293b',
        corMenuTexto: '#94a3b8',
        corCardBg: '#1e293b',
        corCardBorda: '#334155',
        corFooterBg: '#0f172a',
        corFooterTexto: '#94a3b8'
      };

      Object.entries(padroes).forEach(([key, value]) => {
        document.getElementById(key).value = value;
        document.getElementById(key + 'Texto').value = value;
      });

      atualizarPreview();
      alert('‚úÖ Cores restauradas para os valores padr√£o!');
    }

    // Upload de logo
    document.getElementById('logoUpload').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        alert('Selecione apenas imagens');
        return;
      }

      if (file.size > 2 * 1024 * 1024) {
        alert('Imagem muito grande (m√°x. 2MB)');
        return;
      }

      try {
        const loadingEl = document.getElementById('logoPreview');
        loadingEl.innerHTML = '<p>Enviando logo...</p>';
        loadingEl.style.display = 'block';

        const url = await ProdutosService.uploadImagem(file);

        document.getElementById('logoUrl').value = url;
        loadingEl.innerHTML = `<img src="${url}" alt="Logo">`;

        // Atualizar preview
        document.getElementById('previewLogo').innerHTML = `<img src="${url}" style="height: 40px;">`;
      } catch (error) {
        console.error(error);
        alert('Erro ao enviar logo');
      }
    });

    // Carregar configura√ß√µes
    async function carregarConfiguracoes() {
      const config = await ConfigService.buscar();

      document.getElementById('nomeLoja').value = config.nomeLoja || '';
      document.getElementById('logoUrl').value = config.logoUrl || '';
      document.getElementById('avisoTexto').value = config.avisoTexto || '';
      document.getElementById('avisoBotaoTexto').value = config.avisoBotaoTexto || '';
      document.getElementById('avisoBotaoUrl').value = config.avisoBotaoUrl || '';
      document.getElementById('taxaMotoboy').value = config.taxaMotoboy || 0;
      document.getElementById('exibirTaxaEntrega').checked = config.exibirTaxaEntrega !== false;

      // Cores
      if (config.customizacao) {
        const cores = {
          corPrimaria: config.customizacao.corPrimaria || '#6366f1',
          corSecundaria: config.customizacao.corSecundaria || '#10b981',
          corFundo: config.customizacao.corFundo || '#0f172a',
          corTexto: config.customizacao.corTexto || '#f1f5f9',
          corHeaderBg: config.customizacao.corHeaderBg || '#1e293b',
          corMenuTexto: config.customizacao.corMenuTexto || '#94a3b8',
          corCardBg: config.customizacao.corCardBg || '#1e293b',
          corCardBorda: config.customizacao.corCardBorda || '#334155',
          corFooterBg: config.customizacao.corFooterBg || '#0f172a',
          corFooterTexto: config.customizacao.corFooterTexto || '#94a3b8'
        };

        Object.entries(cores).forEach(([key, value]) => {
          document.getElementById(key).value = value;
          document.getElementById(key + 'Texto').value = value;
        });
      }

      // Logo preview
      if (config.logoUrl) {
        const preview = document.getElementById('logoPreview');
        preview.innerHTML = `<img src="${config.logoUrl}" alt="Logo">`;
        preview.style.display = 'block';

        document.getElementById('previewLogo').innerHTML = 
          `<img src="${config.logoUrl}" style="height: 40px;">`;
      }

      atualizarPreview();
    }

    // Salvar configura√ß√µes
    document.getElementById('configVisualForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const config = {
        nomeLoja: document.getElementById('nomeLoja').value.trim(),
        logoUrl: document.getElementById('logoUrl').value.trim(),
        avisoTexto: document.getElementById('avisoTexto').value.trim(),
        avisoBotaoTexto: document.getElementById('avisoBotaoTexto').value.trim(),
        avisoBotaoUrl: document.getElementById('avisoBotaoUrl').value.trim(),
        taxaMotoboy: parseFloat(document.getElementById('taxaMotoboy').value) || 0,
        exibirTaxaEntrega: document.getElementById('exibirTaxaEntrega').checked,
        customizacao: {
          corPrimaria: document.getElementById('corPrimaria').value,
          corSecundaria: document.getElementById('corSecundaria').value,
          corFundo: document.getElementById('corFundo').value,
          corTexto: document.getElementById('corTexto').value,
          corHeaderBg: document.getElementById('corHeaderBg').value,
          corMenuTexto: document.getElementById('corMenuTexto').value,
          corCardBg: document.getElementById('corCardBg').value,
          corCardBorda: document.getElementById('corCardBorda').value,
          corFooterBg: document.getElementById('corFooterBg').value,
          corFooterTexto: document.getElementById('corFooterTexto').value
        }
      };

      const result = await ConfigService.salvar(config);

      if (result.success) {
        alert('‚úÖ Configura√ß√µes salvas com sucesso!');
      } else {
        alert('‚ùå Erro ao salvar configura√ß√µes');
      }
    });

    // Inicializar
    carregarConfiguracoes();
  </script>
  
</body>
</html>